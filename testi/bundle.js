!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t={};let m,w,i={};function s(t,e){i[t]=i[t]||[],i[t].push(e)}function h(t,e){i[t]=(i[t]||[]).filter(t=>t!=e)}function g(t,...e){(i[t]||[]).map(t=>t(...e))}function n(){return m}function a(){return w}function r(t){if(m=document.getElementById(t)||t||document.querySelector("canvas"),!m)throw Error("You must provide a canvas element for the game");return w=m.getContext("2d"),w.imageSmoothingEnabled=!1,g("init"),{canvas:m,context:w}}class o{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;var{width:i,height:s,margin:t=0}=t.frame;this.width=i,this.height=s,this.margin=t,this._f=0,this._a=0}clone(){return new o(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;1<=this._a*this.frameRate;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:h=w}){var n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,a*this.width+(2*a+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,e,i,s)}}function d(){return new o(...arguments)}d.prototype=o.prototype,d.class=o;let l=/(jpeg|jpg|gif|png)$/,c=/(wav|mp3|ogg|aac)$/,u=/^\//,p=/\/$/,f=new WeakMap,_="",y="",x="";function v(t,e){return new URL(t,e).href}function b(t,e){return[t.replace(p,""),t?e.replace(u,""):e].filter(t=>t).join("/")}function C(t){return t.split(".").pop()}function M(t){let e=t.replace("."+C(t),"");return 2==e.split("/").length?e.replace(u,""):e}let S={},k={},P={};function A(){window.__k||(window.__k={dm:f,u:v,d:P,i:S})}function j(t){_=t}function E(t){y=t}function O(t){x=t}function T(n){return A(),new Promise((t,e)=>{let i,s,h;if(i=b(_,n),S[i])return t(S[i]);s=new Image,s.onload=function(){h=v(i,window.location.href),g("assetLoaded",S[M(n)]=S[i]=S[h]=this,n),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function I(o){return new Promise((t,e)=>{let i,s,h,n,a=o;var r;return i=new Audio,s={wav:(r=i).canPlayType('audio/wav; codecs="1"'),mp3:r.canPlayType("audio/mpeg;"),ogg:r.canPlayType('audio/ogg; codecs="vorbis"'),aac:r.canPlayType("audio/aac;")},(o=[].concat(o).reduce((t,e)=>t||(s[C(e)]?e:null),0))?(h=b(y,o),k[h]?t(k[h]):(i.addEventListener("canplay",function(){n=v(h,window.location.href),g("assetLoaded",k[M(o)]=k[h]=k[n]=this,o),t(this)}),i.onerror=function(){e("Unable to load audio "+h)},i.src=h,void i.load())):e("cannot play any of the audio formats provided "+a)})}function R(e){let i,s;return A(),i=b(x,e),P[i]?Promise.resolve(P[i]):fetch(i).then(t=>{if(!t.ok)throw t;return t.clone().json().catch(()=>t.text())}).then(t=>(s=v(i,window.location.href),"object"==typeof t&&f.set(t,s),g("assetLoaded",P[M(e)]=P[i]=P[s]=t,e),t))}function D(...t){return A(),Promise.all(t.map(t=>{let e=C([].concat(t)[0]);return(e.match(l)?T:e.match(c)?I:R)(t)}))}function Y(t){return t*Math.PI/180}function L(t){return 180*t/Math.PI}function z(t,e){return Math.atan2(e.y-t.y,e.x-t.x)+Math.PI/2}function H(t,e){var i=Math.sin(e),e=Math.cos(e);return{x:t.x*e-t.y*i,y:t.x*i+t.y*e}}function W(t,e){return Math.floor(Math.random()*(e-t+1))+t}function X(t){for(var e=0,i=2166136261;e<t.length;e++)i=Math.imul(i^t.charCodeAt(e),16777619);i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17;let s=(i+=i<<5)>>>0,h=()=>(2**31-1&(s=Math.imul(48271,s)))/2**31;return h(),h}function B(t,e,i){return t*(1-i)+e*i}function N(t,e,i){return(i-t)/(e-t)}function G(t,e,i){return Math.min(Math.max(t,i),e)}function F(t,e){void 0===e?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(e))}function U(t){let e=localStorage.getItem(t);try{e=JSON.parse(e)}catch(t){}return e}function K(t,e){return t.rotation||e.rotation?null:([t,e]=[t,e].map(t=>q(t)),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y)}function q(t){let{x:e=0,y:i=0,width:s,height:h}=t.world||t;return t.mapwidth&&(s=t.mapwidth,h=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=h*t.anchor.y),s<0&&(e+=s,s*=-1),h<0&&(i+=h,h*=-1),{x:e,y:i,width:s,height:h}}class ${constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new $(this.x+t.x,this.y+t.y,this)}subtract(t){return new $(this.x-t.x,this.y-t.y,this)}scale(t){return new $(this.x*t,this.y*t)}normalize(t=this.length()){return new $(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?G(this._a,this._d,t):t}set y(t){this._y=this._c?G(this._b,this._e,t):t}}function V(){return new $(...arguments)}V.prototype=$.prototype,V.class=$;const Q=()=>{},Z="position:absolute;left:-9999px";function J(t,e){let i=e.parentNode;t.setAttribute("data-kontra",""),i?(e=i.querySelector("[data-kontra]:last-of-type")||e,i.insertBefore(t,e.nextSibling)):document.body.appendChild(t)}class tt extends class{constructor(t){return this.init(t)}init(t={}){this.position=V(),this.velocity=V(),this.acceleration=V(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return 0<this.ttl}_pc(){}}{init({width:t=0,height:e=0,context:i=w,render:s=this.draw,update:h=this.advance,children:n=[],anchor:a={x:0,y:0},sx:r=0,sy:o=0,opacity:d=1,rotation:l=0,scaleX:c=1,scaleY:u=1,...p}={}){this.children=[],super.init({width:t,height:e,context:i,anchor:a,sx:r,sy:o,opacity:d,rotation:l,scaleX:c,scaleY:u,...p}),this._di=!0,this._uw(),n.map(t=>this.addChild(t)),this._rf=s,this._uf=h}update(e){this._uf(e),this.children.map(t=>t.update&&t.update(e))}render(t){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.sx||this.sy)&&e.translate(-this.sx,-this.sy),1==this.scaleX&&1==this.scaleY||e.scale(this.scaleX,this.scaleY);var i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&e.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&e.translate(-i,-s);let h=this.children;t&&(h=h.filter(t)),h.map(t=>t.render&&t.render()),e.restore()}draw(){}_pc(t,e){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){var t,e,i,s,h,n;this._di&&({_wx:t=0,_wy:e=0,_wo:h=1,_wr:n=0,_wsx:i=1,_wsy:s=1}=this.parent||{},this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=h*this.opacity,this._wr=n+this.rotation,{x:h,y:n}=H({x:this.x,y:this.y},n),this._wx=h,this._wy=n,this._wsx=i*this.scaleX,this._wsy=s*this.scaleY,this._wx=this.x*i,this._wy=this.y*s,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wx+=t,this._wy+=e)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}addChild(t,{}={}){this.children.push(t),t.parent=this,t._pc=t._pc||Q,t._pc()}removeChild(t){var e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null,t._pc())}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function et(){return new tt(...arguments)}et.prototype=tt.prototype;class it extends(et.class=tt){init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function st(){return new it(...arguments)}st.prototype=it.prototype,st.class=it;let ht=/(\d+)(\w+)/;class nt extends et.class{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=w.font,...h}={}){super.init({text:t=""+t,textAlign:e,lineHeight:i,font:s,...h}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=t}get font(){return this._f}set font(t){var e;this._d=!0,this._f=t,this._fs=(e=t.match(ht),t=+e[1],e[2],t)}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let s=this.context;if(s.font=this.font,!this._s.length&&this._fw){let t=this.text.split(" "),e=0,i=2;for(;i<=t.length;i++){var h=t.slice(e,i).join(" ");s.measureText(h).width>this._fw&&(this._s.push(t.slice(e,i-1).join(" ")),e=i-1)}this._s.push(t.slice(e,i).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map(t=>{this._s.push(t),e=Math.max(e,s.measureText(t).width)}),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||s.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let i,s,h=this.context;s=this.textAlign||("rtl"===h.canvas.dir?"right":"left"),i="right"===s?this.width:"center"===s?this.width/2|0:0,this._s.map((t,e)=>{h.textBaseline="top",h.textAlign=s,h.fillStyle=this.color,h.font=this.font,h.fillText(t,i,this._fs*this.lineHeight*e)})}}function at(){return new nt(...arguments)}at.prototype=nt.prototype,at.class=nt;let rt=new WeakMap,ot={},dt={},lt={0:"left",1:"middle",2:"right"};function ct(t=m){return rt.get(t)}function ut(i){var s=i._lf.length?i._lf:i._cf;for(let e=s.length-1;0<=e;e--){let t=s[e];if(t.collidesWithPointer?t.collidesWithPointer(i):function(t,e){let{x:i,y:s,width:h,height:n}=q(t);for(;i-=t.sx||0,s-=t.sy||0,t=t.parent;);var a=e.x-Math.max(i,Math.min(e.x,i+h)),r=e.y-Math.max(s,Math.min(e.y,s+n));return a*a+r*r<e.radius*e.radius}(t,i))return t}}function pt(t,e){return parseFloat(t.getPropertyValue(e))||0}function ft(t){var e=void 0!==t.button?lt[t.button]:"left";dt[e]=!0,mt(t,"onDown")}function gt(t){var e=void 0!==t.button?lt[t.button]:"left";dt[e]=!1,mt(t,"onUp")}function _t(t){mt(t,"onOver")}function yt(t){rt.get(t.target)._oo=null,dt={}}function mt(e,i){e.preventDefault();let s=e.target,l=rt.get(s),{scaleX:h,scaleY:n,offsetX:a,offsetY:r}=function(){let{canvas:t,_s:e}=l,i=t.getBoundingClientRect(),s="none"!==e.transform?e.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(s[0]),n=parseFloat(s[3]),a=(pt(e,"border-left-width")+pt(e,"border-right-width"))*h,r=(pt(e,"border-top-width")+pt(e,"border-bottom-width"))*n,o=(pt(e,"padding-left")+pt(e,"padding-right"))*h,d=(pt(e,"padding-top")+pt(e,"padding-bottom"))*n;return{scaleX:(i.width-a-o)/t.width,scaleY:(i.height-r-d)/t.height,offsetX:i.left+(pt(e,"border-left-width")+pt(e,"padding-left"))*h,offsetY:i.top+(pt(e,"border-top-width")+pt(e,"padding-top"))*n}}();if(-1!==["touchstart","touchmove","touchend"].indexOf(e.type)){l.touches={};for(var o=0;o<e.touches.length;o++)l.touches[e.touches[o].identifier]={id:e.touches[o].identifier,x:(e.touches[o].clientX-a)/h,y:(e.touches[o].clientY-r)/n,changed:!1};for(o=e.changedTouches.length;o--;){const s=e.changedTouches[o].identifier;void 0!==l.touches[s]&&(l.touches[s].changed=!0);var d=e.changedTouches[o].clientX,c=e.changedTouches[o].clientY;l.x=(d-a)/h,l.y=(c-r)/n;let t=ut(l);t&&t[i]&&t[i](e),ot[i]&&ot[i](e,t)}}else{l.x=(e.clientX-a)/h,l.y=(e.clientY-r)/n;let t=ut(l);t&&t[i]&&t[i](e),ot[i]&&ot[i](e,t),"onOver"==i&&(t!=l._oo&&l._oo&&l._oo.onOut&&l._oo.onOut(e),l._oo=t)}}function wt(t=m){let e=rt.get(t);var i;return e||(i=window.getComputedStyle(t),e={x:0,y:0,radius:5,touches:{},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},rt.set(t,e)),t.addEventListener("mousedown",ft),t.addEventListener("touchstart",ft),t.addEventListener("mouseup",gt),t.addEventListener("touchend",gt),t.addEventListener("touchcancel",gt),t.addEventListener("blur",yt),t.addEventListener("mousemove",_t),t.addEventListener("touchmove",_t),e._t||(e._t=!0,s("tick",()=>{e._lf.length=0,e._cf.map(t=>{e._lf.push(t)}),e._cf.length=0})),e}function xt(...t){t.map(t=>{let e=t.context?t.context.canvas:m,i=rt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}function vt(...t){t.map(t=>{let e=t.context?t.context.canvas:m,i=rt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t._r,t._r=0;t=i._o.indexOf(t);-1!==t&&i._o.splice(t,1)})}function bt(t){let e=t.context?t.context.canvas:m,i=rt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");return i._o.includes(t)&&ut(i)===t}function Ct(t){ot.onDown=t}function Mt(t){ot.onUp=t}function St(t){return!!dt[t]}class kt extends st.class{init({padX:t=0,padY:e=0,text:i,onDown:s,onUp:h,...n}={}){super.init({padX:t,padY:e,...n}),this.textNode=at({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),xt(this),this.addChild(this.textNode),this._od=s||Q,this._ou=h||Q;const a=this._dn=document.createElement("button");a.style=Z,a.textContent=this.text,a.addEventListener("focus",()=>this.focus()),a.addEventListener("blur",()=>this.blur()),a.addEventListener("keydown",t=>this._kd(t)),a.addEventListener("keyup",t=>this._ku(t)),J(a,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!==this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();var t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}_ku(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}function Pt(){return new kt(...arguments)}function At(t){var e=t.canvas;t.clearRect(0,0,e.width,e.height)}function jt({fps:t=60,clearCanvas:e=!0,update:i=Q,render:s,context:h=w}={}){if(!s)throw Error("You must provide a render() function");let n,a,r,o,d,l=0,c=1e3/t,u=1/t,p=e?At:Q;function f(){if(a=requestAnimationFrame(f),r=performance.now(),o=r-n,n=r,!(1e3<o)){for(g("tick"),l+=o;l>=c;)d.update(u),l-=c;p(h),d.render()}}return d={update:i,render:s,isStopped:!0,start(){n=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:f,set _last(t){n=t}},d}Pt.prototype=kt.prototype,Pt.class=kt;let Et={set:(t,e,i)=>(e.startsWith("_")||(t._d=!0),Reflect.set(t,e,i))},Ot={start:t=>t?1:0,center:()=>.5,end:t=>t?0:1};class Tt extends et.class{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:h=0,numCols:n=1,dir:a="",breakpoints:r=[],...o}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:h,numCols:n,dir:a,breakpoints:r,...o}),this._p(),new Proxy(this,Et)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(t=>{t.metric.call(this)&&this._b!==t&&(this._b=t).callback.call(this)});let s=this._g=[],f=this._cw=[],g=this._rh=[],e=this.children,h=this._nc="column"===this.flow?1:"row"===this.flow?e.length:this.numCols,n=0,a=0;for(let i,t=0;i=e[t];t++){s[n]=s[n]||[],i._p&&i._p(),g[n]=Math.max(g[n]||0,i.height);let t=i.colSpan||1,e=t;for(;f[a]=Math.max(f[a]||0,i.width/e),s[n][a]=i,e+a++<=h&&--t;);a>=h&&(a=0,n++)}for(;0<a&&a<h;)s[n][a++]=!1;let i=s.length,_=[].concat(this.colGap),r=[].concat(this.rowGap);this._w=f.reduce((t,e)=>t+e,0);for(let t=0;t<h-1;t++)this._w+=_[t%_.length];this._h=g.reduce((t,e)=>t+e,0);for(let t=0;t<i-1;t++)this._h+=r[t%r.length];this._uw();var t="rtl"===this.context.canvas.dir&&!this.dir||"rtl"===this.dir;(this._rtl=t)&&(this._g=s.map(t=>t.reverse()),this._cw=f.reverse());let y=-this.anchor.y*this.height,m=[];this._g.map((t,u)=>{let p=-this.anchor.x*this.width;t.map((l,c)=>{if(l&&!m.includes(l)){m.push(l);let t=Ot[l.justifySelf||this.justify](this._rtl),e=Ot[l.alignSelf||this.align](),i=l.colSpan||1,s=f[c];if(1<i&&c+i<=this._nc)for(let t=1;t<i;t++)s+=f[c+t]+_[(c+t)%_.length];let h=s*t,n=g[u]*e,a=0,r=0,{width:o,height:d}=l;l.anchor&&(a=l.anchor.x,r=l.anchor.y),0===t?h+=o*a:.5===t?h+=(a<.5?-1:.5===a?0:1)*o*t:h-=o*(1-a),0===e?n+=d*r:.5===e?n+=(r<.5?-1:.5===r?0:1)*d*e:n-=d*(1-r),l.x=p+h,l.y=y+n}p+=f[c]+_[c%_.length]}),y+=g[u]+r[u%r.length]})}}function It(){return new Tt(...arguments)}It.prototype=Tt.prototype,It.class=Tt;let Rt={},Dt={},Yt={},Lt={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down"};function zt(t){var e=Lt[t.code];Yt[e]=!0,Rt[e]&&Rt[e](t)}function Ht(t){var e=Lt[t.code];Yt[e]=!1,Dt[e]&&Dt[e](t)}function Wt(){Yt={}}function Xt(){let t;for(t=0;t<26;t++)Lt[t+65]=Lt["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)Lt[48+t]=Lt["Digit"+t]=""+t;window.addEventListener("keydown",zt),window.addEventListener("keyup",Ht),window.addEventListener("blur",Wt)}function Bt(t,e,i="keydown"){const s="keydown"==i?Rt:Dt;[].concat(t).map(t=>s[t]=e)}function Nt(t,e="keydown"){const i="keydown"==e?Rt:Dt;[].concat(t).map(t=>i[t]=0)}function Gt(t){return!!Yt[t]}function Ft(t){let e=t.substr(t.search(/[A-Z]/));return e[0].toLowerCase()+e.substr(1)}function Ut(t,e){e=t.indexOf(e);-1!==e&&t.splice(e,1)}function Kt(t,e){let s=t.prototype;s&&(s._inc||(s._inc={},s._bInc=function(i,t,...e){return this._inc[t].before.reduce((t,e)=>{return e(i,...t)||t},e)},s._aInc=function(i,t,e,...s){return this._inc[t].after.reduce((t,e)=>{return e(i,t,...s)||t},e)}),Object.getOwnPropertyNames(e).forEach(t=>{let i=Ft(t);s[i]&&(s["_o"+i]||(s["_o"+i]=s[i],s[i]=function(...t){var e=this._bInc(this,i,...t),e=s["_o"+i].call(this,...e);return this._aInc(this,i,e,...t)}),s._inc[i]||(s._inc[i]={before:[],after:[]}),t.startsWith("before")?s._inc[i].before.push(e[t]):t.startsWith("after")&&s._inc[i].after.push(e[t]))}))}function qt(t,i){let s=t.prototype;s&&s._inc&&Object.getOwnPropertyNames(i).forEach(t=>{var e=Ft(t);t.startsWith("before")?Ut(s._inc[e].before,i[t]):t.startsWith("after")&&Ut(s._inc[e].after,i[t])})}function $t(t,e){let i=t.prototype;i&&Object.getOwnPropertyNames(e).forEach(t=>{i[t]||(i[t]=e[t])})}class Vt{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size===this.objects.length){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(e){let i,s=!1;for(let t=this.size;t--;)i=this.objects[t],i.update(e),i.isAlive()||(s=!0,this.size--);s&&this.objects.sort((t,e)=>e.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function Qt(){return new Vt(...arguments)}function Zt(t,e){let i=[],s=e.x+e.width/2,h=e.y+e.height/2;q(t);var n=t.y<h,e=t.y+t.height>=h;return t.x<s&&(n&&i.push(0),e&&i.push(2)),t.x+t.width>=s&&(n&&i.push(1),e&&i.push(3)),i}Qt.prototype=Vt.prototype,Qt.class=Vt;class Jt{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;e=m;this.bounds=i||{x:0,y:0,width:e.width,height:e.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(e){let i=new Set;return this._s.length&&this._b?(Zt(e,this.bounds).map(t=>{this._s[t].get(e).map(t=>i.add(t))}),Array.from(i)):this._o.filter(t=>t!==e)}add(...t){t.map(t=>{Array.isArray(t)?this.add.apply(this,t):this._b?this._a(t):(this._o.push(t),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(t=>this._a(t)),this._o.length=0))})}_a(e){Zt(e,this.bounds).map(t=>{this._s[t].add(e)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new Jt({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(2<=i?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1,this._s[i]._p=this}}function te(){return new Jt(...arguments)}function ee(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map(t=>{e=e.concat(ee(t))}),e}te.prototype=Jt.prototype,te.class=Jt;class ie extends et.class{init({id:t,name:e=t,cullObjects:i=!0,cullFunction:s=K,...h}){const n=this._dn=document.createElement("section");n.tabIndex=-1,n.style=Z,n.id=t,n.setAttribute("aria-label",e),super.init({id:t,name:e,cullObjects:i,cullFunction:s,...h}),J(n,this.context.canvas);h=this.context.canvas;this.camera=et({x:h.width/2,y:h.height/2,width:h.width,height:h.height,anchor:{x:.5,y:.5}}),this.camera._pc=()=>{super._pc.call(this.camera),this.context.canvas,this.camera._wx=this.camera.x*this.scaleX,this.camera._wy=this.camera.y*this.scaleY}}show(){this.hidden=this._dn.hidden=!1;let t=this.children.find(t=>t.focus);(t||this._dn).focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}addChild(t,e){super.addChild(t,e),ee(t).map(t=>{this._dn.appendChild(t)})}removeChild(t){super.removeChild(t),ee(t).map(t=>{J(t,this.context.canvas)})}destroy(){this._dn.remove(),this.children.map(t=>t.destroy&&t.destroy())}update(t){this.hidden||super.update(t)}lookAt(t){let e=(t=t.world||t).x,i=t.y;t.scaleX&&(e/=t.scaleX,i/=t.scaleY),this.camera.x=e,this.camera.y=i,this._pc()}_pc(){super._pc(),this.camera&&this.camera._pc()}render(){var{x:t,y:e,width:i,height:s}=this.camera;this.sx=t*this.scaleX-i/2,this.sy=e*this.scaleY-s/2,this.hidden||super.render(t=>!this.cullObjects||this.cullFunction(t,this.camera))}onShow(){}onHide(){}}function se(){return new ie(...arguments)}se.prototype=ie.prototype,se.class=ie;class he{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){var{frames:s,frameRate:h,loop:n}=t[i];if(e=[],void 0===s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(t=>{e=e.concat(function(t){if(+t===t)return t;let e=[],i=t.split(".."),s=+i[0],h=+i[1],n=s;if(s<h)for(;n<=h;n++)e.push(n);else for(;n>=h;n--)e.push(n);return e}(t))}),this.animations[i]=d({spriteSheet:this,frames:e,frameRate:h,loop:n})}}}function ne(){return new he(...arguments)}function ae(e){let{width:t,height:i,tilewidth:s,tileheight:h,context:n=w}=e,a=t*s,r=i*h,o=document.createElement("canvas"),d=o.getContext("2d");o.width=a,o.height=r;let l={},c={},u=[],p=Object.assign({context:n,mapwidth:a,mapheight:r,_sx:0,_sy:0,_d:!1,get sx(){return this._sx},get sy(){return this._sy},set sx(t){this._sx=G(0,a-m.width,t),u.forEach(t=>t.sx=this._sx)},set sy(t){this._sy=G(0,r-m.height,t),u.forEach(t=>t.sy=this._sy)},render(){this._d&&(this._d=!1,this._p()),y(o)},renderLayer(t){let e=c[t],i=l[t];e||(e=document.createElement("canvas"),e.width=a,e.height=r,c[t]=e,p._r(i,e.getContext("2d"))),i._d&&(i._d=!1,e.getContext("2d").clearRect(0,0,e.width,e.height),p._r(i,e.getContext("2d"))),y(e)},layerCollidesWith(t,i){var{x:e,y:s,width:h,height:n}=q(i),i=f(s),a=g(e),r=f(s+n),o=g(e+h),d=l[t];for(let e=i;e<=r;e++)for(let t=a;t<=o;t++)if(d.data[t+e*this.width])return!0;return!1},tileAtLayer(t,e){var i=e.row||f(e.y),e=e.col||g(e.x);return l[t]?l[t].data[e+i*p.width]:-1},setTileAtLayer(t,e,i){var s=e.row||f(e.y),e=e.col||g(e.x);l[t]&&(this._d=!0,l[t]._d=!0,l[t].data[e+s*p.width]=i)},setLayer(t,e){l[t]&&(this._d=!0,l[t]._d=!0,l[t].data=e)},addObject(t){u.push(t),t.sx=this._sx,t.sy=this._sy},removeObject(t){var e=u.indexOf(t);-1!==e&&(u.splice(e,1),t.sx=t.sy=0)},_r:function(t,l){l.save(),l.globalAlpha=t.opacity,(t.data||[]).map((i,t)=>{if(i){let e;for(let t=p.tilesets.length-1;0<=t&&(e=p.tilesets[t],!(1<=i/e.firstgid));t--);var s=e.tilewidth||p.tilewidth,h=e.tileheight||p.tileheight,n=e.margin||0,a=e.image,r=i-e.firstgid,o=e.columns||a.width/(s+n)|0,d=t%p.width*s,t=(t/p.width|0)*h;l.drawImage(a,r%o*(s+n),(r/o|0)*(h+n),s,h,d,t,s,h)}}),l.restore()},_p:_,layerCanvases:c,layerMap:l},e);function f(t){return t/p.tileheight|0}function g(t){return t/p.tilewidth|0}function _(){p.layers&&p.layers.map(t=>{t._d=!1,(l[t.name]=t).data&&!1!==t.visible&&p._r(t,d)})}function y(t){var{width:e,height:i}=m,e=Math.min(t.width,e),i=Math.min(t.height,i);p.context.drawImage(t,p.sx,p.sy,e,i,0,0,e,i)}return p.tilesets.map(i=>{var t=(window.__k?window.__k.dm.get(e):"")||window.location.href;if(i.source){if(!window.__k)throw Error('You must use "load" or "loadData" to resolve tileset.source');let e=window.__k.d[window.__k.u(i.source,t)];if(!e)throw Error(`You must load the tileset source "${i.source}" before loading the tileset`);Object.keys(e).map(t=>{i[t]=e[t]})}if(""+i.image===i.image){if(!window.__k)throw Error('You must use "load" or "loadImage" to resolve tileset.image');t=window.__k.i[window.__k.u(i.image,t)];if(!t)throw Error(`You must load the image "${i.image}" before loading the tileset`);i.image=t}}),_(),p}ne.prototype=he.prototype,ne.class=he;var re={Animation:d,imageAssets:S,audioAssets:k,dataAssets:P,setImagePath:j,setAudioPath:E,setDataPath:O,loadImage:T,loadAudio:I,loadData:R,load:D,Button:Pt,init:r,getCanvas:n,getContext:a,on:s,off:h,emit:g,GameLoop:jt,GameObject:et,Grid:It,degToRad:Y,radToDeg:L,angleToTarget:z,rotatePoint:H,randInt:W,seedRand:X,lerp:B,inverseLerp:N,clamp:G,setStoreItem:F,getStoreItem:U,collides:K,getWorldRect:q,keyMap:Lt,initKeys:Xt,bindKeys:Bt,unbindKeys:Nt,keyPressed:Gt,registerPlugin:Kt,unregisterPlugin:qt,extendObject:$t,initPointer:wt,getPointer:ct,track:xt,untrack:vt,pointerOver:bt,onPointerDown:Ct,onPointerUp:Mt,pointerPressed:St,Pool:Qt,Quadtree:te,Scene:se,Sprite:st,SpriteSheet:ne,Text:at,TileEngine:ae,Vector:V},oe=function(i){if(i.__esModule)return i;var s=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(t){var e=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(s,t,e.get?e:{enumerable:!0,get:function(){return i[t]}})}),s}(Object.freeze({__proto__:null,default:re,Animation:d,imageAssets:S,audioAssets:k,dataAssets:P,setImagePath:j,setAudioPath:E,setDataPath:O,loadImage:T,loadAudio:I,loadData:R,load:D,Button:Pt,init:r,getCanvas:n,getContext:a,on:s,off:h,emit:g,GameLoop:jt,GameObject:et,Grid:It,degToRad:Y,radToDeg:L,angleToTarget:z,rotatePoint:H,randInt:W,seedRand:X,lerp:B,inverseLerp:N,clamp:G,setStoreItem:F,getStoreItem:U,collides:K,getWorldRect:q,keyMap:Lt,initKeys:Xt,bindKeys:Bt,unbindKeys:Nt,keyPressed:Gt,registerPlugin:Kt,unregisterPlugin:qt,extendObject:$t,initPointer:wt,getPointer:ct,track:xt,untrack:vt,pointerOver:bt,onPointerDown:Ct,onPointerUp:Mt,pointerPressed:St,Pool:Qt,Quadtree:te,Scene:se,Sprite:st,SpriteSheet:ne,Text:at,TileEngine:ae,Vector:V})),de={};Object.defineProperty(de,"__esModule",{value:!0});const le=oe;de.default=async t=>{var e,i,s,e={tilewidth:64,tileheight:64,width:13,height:55,tilesets:[{firstgid:1,image:t}],layers:[{name:"base",data:(e=[...Array(52).keys()].map(()=>10),i=[...Array(182).keys()].map(t=>t%4?7:14),s=[...Array(182).keys()].map(t=>13-t%2),t=[...Array(182).keys()].map(t=>9-t%2),[...[...Array(130).keys()].map(()=>11),...t,...s,...i,...e])}]};return le.TileEngine(e)};var ce={},ue={};Object.defineProperty(ue,"__esModule",{value:!0});const pe=oe;ue.default=(t,e)=>{var i=pe.getCanvas().height;return e+(t.mapheight-i-t.sy)};var fe=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ce,"__esModule",{value:!0}),ce.getExplosion=void 0;const ge=oe,_e=t,ye=fe(ue),me=ge.Pool({create:ge.Sprite,maxSize:400});ce.default=me,ce.getExplosion=(t,e={color:"red",ttl:60})=>{var i;_e.state.map&&(i=t.world,me.get({x:i.x+t.width/2,y:ye.default(_e.state.map,i.y)+t.height/2,width:4,height:4,anchor:{x:.5,y:.5},dx:2-4*Math.random(),dy:2-4*Math.random(),color:[e.color],ttl:e.ttl}))};var we={},xe={},ve={};Object.defineProperty(ve,"__esModule",{value:!0});const be=oe;ve.default=(t,e)=>{t=be.getWorldRect(t),e=be.getWorldRect(e);return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y};var Ce=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(xe,"__esModule",{value:!0});const Me=oe,Se=Ce(ve),ke=ce;class Pe extends Me.Sprite.class{constructor(t,e,i="gray",s=128,h){super({x:t,y:e,color:i,height:h||s,width:s}),this.hitTime=0,this.checkHit=()=>{this.parent?.player&&Se.default(this.parent.player,this)&&(ke.getExplosion(this),this.parent.removeChild(this))},this.addChild(new Me.Sprite({x:24,y:24,height:80,width:80,color:"white"})),this.addChild(new Me.Text({x:32,y:24,text:"PALM\nOIL\nTANK",font:"24px fantasy",color:"red",textAlign:"center"}))}}class Ae extends Me.Sprite.class{constructor(t,e,i="gray",s=256){super({x:t,y:e,width:s,height:s,color:i}),this.hitTime=0,this.checkHit=()=>{this.parent?.player&&Se.default(this.parent.player,this)&&(ke.getExplosion(this),this.parent.removeChild(this))},this.addChild(new Me.Sprite({x:64,y:24,height:80,width:140,color:"white"})),this.addChild(new Me.Text({x:76,y:24,text:"PALM\nOIL\nFACTORY",font:"24px fantasy",color:"red",textAlign:"center"}))}}class je extends Me.GameObject.class{constructor(t,e){super({x:t,y:e,width:800,height:640}),this.tanks=[],this.createParts=()=>{this.core=new Ae(272,8),this.addChild(this.core);var t=new Pe(416,320);this.addChild(t),this.tanks.push(t);t=new Pe(256,320);this.addChild(t),this.tanks.push(t)},this.update=()=>{this.parent?.player&&(this.player=this.parent.player),this.tanks.forEach(t=>t.checkHit()),this.core&&this.core.checkHit()},this.createParts()}}xe.default=je;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});class Oe extends oe.Sprite.class{constructor(t,e){super({width:400,height:20,color:"lightgreen"}),this.player=t,this.camera=e}render(){var t;this.color&&(this.context.fillStyle=this.color,t=Math.max(0,this.player.health/this.player.maxHealth*this.width),this.context.fillRect(this.context.canvas.width/2-this.width/2,this.camera.y-this.context.canvas.height/2+this.height,t,this.height))}}Ee.default=Oe;var Te={},Ie=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Te,"__esModule",{value:!0});const Re=oe,De=Ie(ue),Ye=Ie(ce);class Le extends Re.Sprite.class{constructor(t,e,i){super({x:390,y:600,anchor:{x:.5,y:.5},image:i,rotation:0}),this.canvas=t,this.map=e,this.maxHealth=20,this.health=this.maxHealth,this.map.sy=this.map.mapheight-t.height}syncCamera(){var t=this.canvas.height/2,e=this.y>t?t:this.y;0<this.map.sy&&this.parent.lookAt({y:e,x:this.canvas.width/2}),this.map.sx=16;t=this.y>t?this.map.mapheight-this.canvas.height:this.map.mapheight-this.canvas.height-(t-this.y);this.map.sy=0<t?t:0}update(){this.handleControls(),this.syncCamera(),this.children.forEach(t=>t.update())}handleControls(){Re.keyPressed("left")||Re.keyPressed("j")?(this.ddx=-.13,this.ddy=0,this.dx=-Math.abs(this.dx)-Math.abs(this.dy),this.dy=0,this.rotation=Re.degToRad(-90)):Re.keyPressed("right")||Re.keyPressed("l")?(this.ddx=.13,this.ddy=0,this.dx=Math.abs(this.dx)+Math.abs(this.dy),this.dy=0,this.rotation=Re.degToRad(90)):Re.keyPressed("up")||Re.keyPressed("i")?(this.ddx=0,this.ddy=-.13,this.dy=-Math.abs(this.dy)-Math.abs(this.dx),this.dx=0,this.rotation=Re.degToRad(0)):Re.keyPressed("down")||Re.keyPressed("k")?(this.ddx=0,this.ddy=.13,this.dy=Math.abs(this.dy)+Math.abs(this.dx),this.dx=0,this.rotation=Re.degToRad(180)):(this.ddx=0,this.ddy=0),this.dx=Math.sign(this.dx)*Math.max(Math.abs(this.dx)-.1,0),this.dy=Math.sign(this.dy)*Math.max(Math.abs(this.dy)-.1,0),this.x>this.canvas.width-this.width?(this.dx=0,this.x=this.canvas.width-this.width):this.x<0&&(this.dx=0,this.x=0),600<this.y&&(this.dy=0,this.y=600),this.advance(),this.dy=Math.sign(this.dy)*Math.min(Math.abs(this.dy),Math.abs(2.5)),this.dx=Math.sign(this.dx)*Math.min(Math.abs(this.dx),Math.abs(2.5))}handleHitBuilding(){this.dx/=4,this.dy/=4}handleHardHitBuilding(){this.dx=0,this.dy=0}takeDamage(e){var t=this.parent.y+this.y,i=De.default(this.parent.map,t);for(let t=0;t<e+1;t++)Ye.default.get({x:this.parent.x+this.x,y:i,width:4,height:4,dx:1-2*Math.random(),dy:1-2*Math.random(),color:t%2?"yellow":"gray",ttl:120});this.health-=e;const s=new Re.Sprite({x:0,y:0,anchor:this.anchor,width:this.width,height:this.height,color:"red",ttl:8,opacity:.3,update:()=>{s.isAlive()||this.removeChild(s),s.ttl--}});this.addChild(s)}}Te.default=Le;var ze={},re={},fe=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(re,"__esModule",{value:!0});const He=oe,We=fe(ue),Xe=fe(ve),Be=fe(ce);class Ne extends He.Sprite.class{constructor(t,e,i,s){super({x:t,y:e,width:64,height:64,animations:{idle:s}}),this.hp=i,this.hitTime=0,this.handleHit=(e,i,s)=>{if(this.hp&&(new Date).getTime()-this.hitTime<1e3)s.handleHardHitBuilding();else if(0!==this.hp&&(--this.hp,this.hitTime=(new Date).getTime(),2===this.hp&&(this.opacity=.88,s.handleHardHitBuilding()),1===this.hp&&(this.opacity=.66,s.handleHardHitBuilding()),0===this.hp&&(this.opacity=.33,s.handleHitBuilding()),this.parent)){let t=0;for(;t<50;){const i=this.parent.y+this.y+this.height/2,s=We.default(e,i);Be.default.get({x:this.parent.x+this.x+this.width/2,y:s,width:4,height:4,anchor:{x:.5,y:.5},dx:2-4*Math.random(),dy:2-4*Math.random(),color:t%2?this.parent.explodeColors.color1:this.parent.explodeColors.color2,ttl:120}),t++}}}}}class Ge extends He.GameObject.class{constructor(t,e,i,s,h,n,a,r){super({x:t,y:e,width:64*i,height:64*s}),this.hp=h,this.ceiling=n,this.wall=a,this.explodeColors=r,this.createParts=(t,i)=>{for(let e=0;e<t;e++)for(let t=0;t<i;t++){const i=0===t?this.ceiling:this.wall;this.addChild(new Ne(64*e,64*t,this.hp,i))}},this.update=e=>{if(this.parent?.removeChild)if(this.children.every(t=>t.hp<=0))this.parent.removeChild(this);else if(Xe.default(this.parent.player,this)){const i=this.parent;i&&this.children.forEach(t=>{t.handleHit&&Xe.default(t,i.player)&&t.handleHit(i.map,e,i.player)})}},this.createParts(i,s)}}re.default=Ge;Ce={},Ie={},fe=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ie,"__esModule",{value:!0});const Fe=oe,Ue=fe(ve);class Ke extends Fe.Sprite.class{constructor(t,e,i,s,h,n="gray",a=4.5){super({x:t,y:e,width:a,height:a,color:n,ttl:60,dx:i.normalize().x*s,dy:i.normalize().y*s}),this.damage=h,this.radius=a}draw(){this.context.fillStyle="black",this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius-.8,0,2*Math.PI),this.context.fill()}update(){if(this.advance(),this.isAlive()||this.parent?.removeChild(this),this.parent?.player){const t=this.parent.player;Ue.default(this,this.parent.player)&&(t.takeDamage(this.damage),this.parent?.removeChild(this))}}}Ie.default=Ke;fe=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ce,"__esModule",{value:!0});const qe=oe,$e=fe(ue),Ve=fe(ve),Qe=fe(ce),Ze=fe(Ie);class Je extends qe.Sprite.class{constructor(t,e,i,s,h,n=1,a=350,r=100,o=90,d=30,l=30,c=1,u=2,p="gray"){super({x:t,y:e,width:i,height:s,color:h}),this.moveSpeed=n,this.visionRange=a,this.attackRange=r,this.attackCooldown=o,this.attackStandStillTime=d,this.attackWindup=l,this.attackDamage=c,this.projectileSpeed=u,this.projectileColor=p,this.cooldownCounter=0,this.standstillCounter=0,this.attackWindupCounter=0}update(){const t=this.parent.player;if(t)if(Ve.default(this.parent.player,this))this.handleBulldozerCollision();else{this.handleBuildingCollision();const e=new qe.Vector(t.x-this.x,t.y-this.y);if(0<this.attackWindupCounter)this.attackWindupCounter>=this.attackWindup?(this.shoot(e),this.attackWindupCounter=0):this.attackWindupCounter++;else{if(e.length()<this.visionRange&&this.standstillCounter<=0){const t=e.length()<this.attackRange?-1:1;this.dx=e.normalize().x*this.moveSpeed*t,this.dy=e.normalize().y*this.moveSpeed*t,this.advance()}else this.dx=0,this.dy=0;e.length()<this.attackRange&&this.cooldownCounter<=0&&(this.cooldownCounter=this.attackCooldown,this.attackWindupCounter++,this.standstillCounter=this.attackStandStillTime),this.cooldownCounter=Math.max(this.cooldownCounter-1,0),this.standstillCounter=Math.max(this.standstillCounter-1,0)}}}handleBulldozerCollision(){let t=0;for(;t<20;){var e=this.parent.y+this.y+this.height/2,e=$e.default(this.parent.map,e);Qe.default.get({x:this.parent.x+this.x+this.width/2,y:e,width:4,height:4,anchor:{x:.5,y:.5},dx:.8*(1-2*Math.random()),dy:.8*(1-2*Math.random()),color:t%2?"red":"darkred",ttl:25}),t++}this.parent.removeChild(this)}shoot(t){t=new Ze.default(this.x,this.y,t,this.projectileSpeed,this.attackDamage,this.projectileColor);this.parent?.addChild(t)}handleBuildingCollision(){this.parent.quadtree.get(this).forEach(t=>{var e,i;t&&Ve.default(this,t)&&(e=0,e=this.x+this.width/2<t.x+t.width/2?this.x+this.width-t.x:this.x-t.x-t.width,i=0,i=this.y+this.height/2<t.y+t.height/2?this.y+this.height-t.y:this.y-t.y-t.height,Math.abs(e)<Math.abs(i)?this.x-=e:this.y-=i)})}}Ce.default=Je;Ie=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ze,"__esModule",{value:!0});const ti=oe,ei=Ie(re),ii=Ie(Ce);ze.default=class{constructor(t,e,i,s,h,n){this.startY=t,this.size=e,this.hp=i,this.ceiling=s,this.wall=h,this.explodeColors=n,this.buildingAmount=33,this.buildings=[],this.enemies=[],this.genBuildings=()=>{let t=this.buildingAmount;for(;0<t;){const e=ti.randInt(1,4),i=ti.randInt(1,3),s=new ei.default(ti.randInt(0,ti.getCanvas().width-64*e),ti.randInt(this.startY-this.size,this.startY),e,i,this.hp,this.ceiling,this.wall,this.explodeColors);this.buildings.some(t=>ti.collides(t,s))||(this.buildings.push(s),t-=e*i)}},this.genBuildings(),this.genEnemies()}genEnemies(){let t=10;for(;0<t;){var e=new ii.default(ti.randInt(0,ti.getCanvas().width),ti.randInt(this.startY-this.size,this.startY),15,30,"brown");this.enemies.push(e),t--}}genPoliceEnemies(){let t=5;for(;0<t;){var e=new ii.default(ti.randInt(0,ti.getCanvas().width),ti.randInt(this.startY-this.size,this.startY),18,30,"blue",.5,350,200,120,60,60,2,4,"red");this.enemies.push(e),t--}}};Ce=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(we,"__esModule",{value:!0});const si=oe,hi=Ce(xe),ni=Ce(Ee),ai=Ce(Te),ri=Ce(ze);class oi extends si.Scene.class{constructor(t,e){super({id:"play",children:[],cullObjects:!1}),this.map=t,this.spriteSheet=e,this.quadtree=new si.Quadtree,this.createPlayer(),this.createZones()}update(t){super.update(t),this.quadtree.clear(),this.quadtree.add(this.children)}async createPlayer(){var t=await si.loadImage("bulldozer.png"),t=new ai.default(si.getCanvas(),this.map,t);this.player=t,this.lookAt(t),this.addChild(t);t=new ni.default(this.player,this.camera);this.addChild(t)}async createZones(){const t=new si.Animation({spriteSheet:this.spriteSheet,frames:[3],frameRate:1}),e=new si.Animation({spriteSheet:this.spriteSheet,frames:[2],frameRate:1}),i=new si.Animation({spriteSheet:this.spriteSheet,frames:[1],frameRate:1}),s=new si.Animation({spriteSheet:this.spriteSheet,frames:[0],frameRate:1}),h=new si.Animation({spriteSheet:this.spriteSheet,frames:[5],frameRate:1}),n=new si.Animation({spriteSheet:this.spriteSheet,frames:[4],frameRate:1}),a=new ri.default(200,500,1,t,e,{color1:"yellow",color2:"orange"}),r=new ri.default(-700,500,2,i,s,{color1:"gray",color2:"orange"}),o=new ri.default(-1600,500,3,h,n,{color1:"yellow",color2:"blue"});a.buildings.forEach(t=>this.addChild(t)),a.enemies.forEach(t=>this.addChild(t)),r.genPoliceEnemies(),r.buildings.forEach(t=>this.addChild(t)),r.enemies.forEach(t=>this.addChild(t)),o.genPoliceEnemies(),o.buildings.forEach(t=>this.addChild(t)),o.enemies.forEach(t=>this.addChild(t)),this.addChild(new hi.default(0,-2880))}}we.default=oi;var di={};Object.defineProperty(di,"__esModule",{value:!0});const li=oe;class ci extends li.Scene.class{constructor(){super({id:"title",children:[],cullObjects:!1}),this.addChild(new li.Sprite({x:0,y:0,width:800,height:640,color:"black"})),this.addChild(new li.Text({x:270,y:24,text:"Living Space Wars\nOrangutan strikes back",font:"24px fantasy",color:"red",textAlign:"center"})),this.addChild(new li.Text({x:250,y:200,text:"<Press ENTER to start>",font:"24px fantasy",color:"red",textAlign:"center"}))}update(){li.keyPressed("enter")&&(console.log("change scene"),this.hide())}}di.default=ci,function(n){var t=e&&e.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.state=void 0;const a=oe,r=t(de),o=t(ce),d=t(we),l=t(di);n.state={},(async()=>{a.init(),a.initKeys();const t=await a.loadImage("tileset.webp"),e=a.SpriteSheet({image:t,frameWidth:64,frameHeight:64}),i=await r.default(t);n.state.map=i;const s=new d.default(i,e),h=new l.default;i.addObject(s),a.GameLoop({update:t=>{h.hidden||h.update(),h.hidden&&s.update(t),o.default.update()},render:()=>{i.render(),s.render(),h.render(),o.default.render()}}).start()})()}(t)}();
